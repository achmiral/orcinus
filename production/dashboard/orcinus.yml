# testing :
#
# curl -H Host:dashboard.orcinus.id http://127.0.0.1

stack: "orcinus-dashboard"
services:
    orcinus-dashboard:
        image: "orcinus/orcinus:dev"
        constraint: "node.role==manager"
        environment:
        - "ORCINUS=prod"
        - "ORCINUS_HTTP_CORS='*'"
        - "ORCINUS_OMURA=orcinus-repository:8080"
        - "ORCINUS_DB=orcinus-db/orcinus"
        - "ORCINUS_DOMAIN=svc.orcinus.id"
        volumes:
        - "docker"
        networks:
        - "orcinus" # webserver network
        labels:
            traefik.port: "4000"
            traefik.frontend.rule: "Host:dashboard.orcinus.id"
    orcinus-repository:
        image: "orcinus/omura"
        constraint: "node.role==manager"
        networks:
        - "orcinus"
        labels:
            traefik.port: "8080"
            traefik.frontend.rule: "Host:omura.orcinus.id"
    orcinus-db:
        image: "mongo:3.5"
        constraint: "node.role==manager"
volumes:
    docker:
        type: "bind"
        source: "/var/run/docker.sock"
        target: "/var/run/docker.sock"