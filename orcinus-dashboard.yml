# testing :
#
# curl -H Host:dashboard.orcinus.id http://127.0.0.1

stack: "orcinus"
services:
    httpd:
        image: "traefik"
        ports:
        - "80:80"
        - "8080:8080"
        constraint: "node.role==manager"
        commands:
        - "--docker"
        - "--docker.swarmmode"
        - "--docker.domain=orcinus.id" # set main domain for production
        - "--docker.watch"
        - "--web"
        volumes:
        - "docker"
    dashboard:
        image: "orcinus/orcinus:dev"
        # ports:
        # - "4000:4000" # remove ports for production
        constraint: "node.role==manager"
        environments:
        - "ORCINUS_HTTP_CORS='*'"
        - "ORCINUS_OMURA=repository:8080"
        volumes:
        - "docker"
        labels:
            traefik.port: "4000"
    repository:
        image: "orcinus/omura"
        constraint: "node.role==manager"

volumes:
    docker:
        type: "bind"
        source: "/var/run/docker.sock"
        target: "/var/run/docker.sock"